syntax = "proto3";

option go_package = "github.com/DataWorkbench/gproto/pkg/fmpb";

package fmpb;

import "github.com/mwitkow/go-proto-validators/validator.proto";
import "model.proto";

service FileManager{
  rpc UploadStream(stream UploadRequest) returns (model.EmptyStruct){}
  rpc DownloadStream(DownloadRequest) returns (stream DownloadReply){}
  rpc GetDirList(GetDirListRequest) returns(GetDirListReply){}
  rpc GetSubDirFile(GetSubDirListRequest) returns (GetSubDirListReply){}
  rpc UpdateFile(UpdateFileRequest)returns (model.EmptyStruct){}
  rpc DeleteFileById(DeleteRequest) returns(model.EmptyStruct){}
  rpc DeleteDirById(DeleteRequest) returns(model.EmptyStruct){}
  rpc GetFileById(IdRequest) returns (FileInfoReply){}
}

message UploadRequest{
  string ID = 1 [(validator.field) = {length_lt: 24}];
  string SpaceID = 2 [(validator.field) = {length_eq: 20}];
  bytes Data = 3;
  string FileName = 4 [(validator.field) = {msg_exists: true}];
  string FileDir = 5 [(validator.field) = {msg_exists: true}];
  int32 FileType = 6 [(validator.field) = {int_lt:4}];
}

message DownloadRequest{
  string ID = 1 [(validator.field) = {length_lt: 24}];
}

message DownloadReply{
  bytes Data = 1;
}

message GetDirListRequest{
  string SpaceID = 1 [(validator.field) = {length_eq: 20}];
}

message GetDirListReply{
  string JsonData = 1;
}

message GetSubDirListRequest{
  string ID = 1 [(validator.field) = {length_lt: 24}];
}

message GetSubDirListReply{
  message Dir{
    string ID = 1;
    string Name = 2;
  }
  message File{
    string ID = 1;
    string Name = 2;
    string URL = 3;
  }
  string ID = 1;
  string Name = 2;
  repeated Dir ChileDirs = 3;
  repeated File ChildFiles = 4;
}

message UpdateFileRequest{
  string ID = 1 [(validator.field) = {length_lt: 24}];
  string Name = 2;
  int32 Type = 3;
  string Path = 4;
}

message DeleteRequest{
  string ID = 1 [(validator.field) = {length_lt: 24}];
}

message IdRequest{
  string ID = 1[(validator.field) = {length_lt: 24}];
}

message FileInfoReply{
  string Name = 1;
  int32 FileType = 2;
  string URL = 4;
  string Path = 5;
}