syntax = "proto3";

option go_package = "github.com/DataWorkbench/gproto/pkg/fmpb";

package fmpb;

import "github.com/mwitkow/go-proto-validators/validator.proto";
import "model.proto";

service FileManager{
  rpc UploadStream(stream UploadRequest) returns (UploadReply){}
  rpc DownloadStream(DownloadRequest) returns (stream DownloadReply){}
  rpc GetFileList(GetFileListRequest) returns(GetFileListReply){}
  rpc GetFileById(IdRequest) returns (FileInfoReply){}
  rpc DeleteFileById(DeleteRequest) returns(model.EmptyStruct){}
  rpc DeleteDirById(DeleteRequest) returns(model.EmptyStruct){}
}

message UploadRequest{
  string ID = 1 [(validator.field) = {length_lt: 25}];
  string SpaceID = 2 [(validator.field) = {length_eq: 20}];
  bytes Data = 3;
  string FileName = 4 [(validator.field) = {msg_exists: true}];
  string FileDir = 5 [(validator.field) = {msg_exists: true}];
  int32 FileType = 6 [(validator.field) = {int_lt:4}];
  string HdfsAddress = 7 [(validator.field) = {msg_exists: true}];
}

message GetFileListRequest{
  string Parent = 1  [(validator.field) = {length_lt: 25}];
  string SpaceID = 2 [(validator.field) = {length_eq: 20}];
  string Address = 3  [(validator.field) = {msg_exists: true}];
  repeated int32 FileType = 4;
}

message DownloadRequest{
  string ID = 1 [(validator.field) = {length_lt: 25}];
}

message DeleteRequest{
  string ID = 1 [(validator.field) = {length_lt: 25}];
}

message IdRequest{
  string ID = 1[(validator.field) = {length_lt: 25}];
}

message GetFileListReply{
  message ListInfo{
    string ID = 1;
    string Name = 2;
    string URL = 3;
    string Dir = 4;
  }
  repeated ListInfo FileInfo = 1;
}

message UploadReply{
  string URL = 1;
}

message DownloadReply{
  bytes Data = 1;
}

message FileInfoReply{
  string Name = 1;
  int32 FileType = 2;
  string Path = 3;
  string Url = 4;
}