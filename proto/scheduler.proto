syntax = "proto3";

option go_package = "github.com/DataWorkbench/gproto/pkg/shpb";

package shpb;

import "github.com/mwitkow/go-proto-validators/validator.proto";
import "model.proto";


// Scheduler Service
service Scheduler {
	// Add adds a release workflow to schedule system.
	rpc Add(AddRequest) returns (model.EmptyStruct) {}
	// Remove removes a workflow from schedule system.
	rpc Remove(RemoveRequest) returns (model.EmptyStruct) {}
	
	// Report reports the node instance task execute result.
	rpc ReportJobState(ReportJobStateRequest) returns (model.EmptyStruct) {}
}

// Request parameters used to Push.
message AddRequest {
	string SpaceId = 1                [ (validator.field) = { length_eq: 20 } ];
	string FlowId = 2                 [ (validator.field) = { length_eq: 20 } ];
	int64  Version = 3                [ (validator.field) = { int_gt: 0 } ];
	repeated model.NodeInfo Nodes = 4 [ (validator.field) = { } ];
	model.SchInfo Schedule = 5        [ (validator.field) = { } ];
}

// Request parameters used to Remove.
message RemoveRequest {
	string FlowId = 1 [ (validator.field) = { length_eq: 20 } ];
}

message ReportJobStateRequest {
	// ID is the node instance id.
	string ID = 1     [ (validator.field) = { length_eq: 20 } ];
	int32  State = 2 [ (validator.field) = { } ];;
	string Message = 3;
}
