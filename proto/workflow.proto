syntax = "proto3";

option go_package = "github.com/DataWorkbench/gproto/pkg/wfpb";

package wfpb;

import "github.com/mwitkow/go-proto-validators/validator.proto";
import "model.proto";

// Workflow Service
service Workflow {
	rpc Lists(ListsRequest)       returns (ListsReply)        {}
	rpc Create(CreateRequest)     returns (model.EmptyStruct) {}
	rpc Delete(DeleteRequest)     returns (model.EmptyStruct) {}
	rpc Update(UpdateRequest)     returns (model.EmptyStruct) {}
	rpc Describe(DescribeRequest) returns (DescribeReply)     {}
	rpc Publish(PublishRequest)   returns (model.EmptyStruct) {}
	rpc Offline(OfflineRequest)   returns (model.EmptyStruct) {}
	// version api
	rpc ListVersions(ListVersionsRequest)                 returns (ListVersionsReply)         {}
	rpc ListScheduleVersions(ListScheduleVersionsRequest) returns (ListScheduleVersionsReply) {}
	// schedule api
	rpc UpsertSchedule(UpsertScheduleRequest)     returns (model.EmptyStruct)     {}
	rpc DescribeSchedule(DescribeScheduleRequest) returns (DescribeScheduleReply) {}
}

// Request parameters used to ListWorkflow
message ListsRequest {
	string space_id = 1 [ (validator.field) = { length_eq: 20 } ];
	int32  limit = 2   [ (validator.field) = { int_gt: 0, int_lt: 101 } ];
	int32  offset = 3  [ (validator.field) = { int_gt: -1 } ];
}

// Reply parameters used to ListWorkflow
message ListsReply {
	repeated model.FlowInfo infos = 1 [ (validator.field) = { msg_exists: false } ];
}

// Request parameters used to ListWorkflowVersions
message ListVersionsRequest {
	string flow_id = 1 [ (validator.field) = { length_eq: 20 } ];
	int32  limit = 2  [ (validator.field) = { int_gt: 0, int_lt: 101 } ];
	int32  offset = 3 [ (validator.field) = { int_gt: -1 } ];
}

// Reply parameters used to ListWorkflowVersions
message ListVersionsReply {
	repeated model.FlowVerInfo infos = 1 [ (validator.field) = { msg_exists: false } ];
}

// Request parameters used to CreateWorkflow
message CreateRequest {
	string space_id = 1 [ (validator.field) = { length_eq: 20 } ];
	string name = 2    [ (validator.field) = { length_gt: 1, length_lt: 129 } ];
	string desc = 3    [ (validator.field) = { length_lt: 1025 } ];
}

// Request parameters used to DeleteWorkflow
message DeleteRequest {
	string id = 2 [ (validator.field) = { length_eq: 20 } ];
}

// Request parameters used to UpdateWorkflow
message UpdateRequest {
	string id = 2   [ (validator.field) = { length_eq: 20} ];
	string name = 3 [ (validator.field) = { length_lt: 129 } ];
	string desc = 4 [ (validator.field) = { length_lt: 1025 } ];
}

// Request parameters used to DescribeWorkflow
message DescribeRequest {
	string id = 2 [ (validator.field) = {length_eq: 20} ];
}

// Reply parameters used to DescribeWorkflow
message DescribeReply {
	model.FlowInfo info = 1;
}

// Request parameters used to PublishRequest
message PublishRequest {
	string id = 2 [ (validator.field) = { length_eq: 20 } ];
}

// Request parameters used to OfflineRequest
message OfflineRequest {
	string id = 2 [ (validator.field) = { length_eq: 20 } ];
}

// Request parameters used to ListScheduleVersions
message ListScheduleVersionsRequest {
	string flow_id = 1 [ (validator.field) = { length_eq: 20 } ];
	int32  limit = 2  [ (validator.field) = { int_gt: 0, int_lt: 101 } ];
	int32  offset = 3 [ (validator.field) = { int_gt: -1 } ];
}

// Reply parameters used to ListScheduleVersions
message ListScheduleVersionsReply {
	repeated model.SchVerInfo infos = 1 [ (validator.field) = { msg_exists: false } ];
}

// Request parameters used to UpsertSchedule
message UpsertScheduleRequest {
	string flow_id = 1            [ (validator.field) = { length_eq: 20 } ];
	int64  started = 2            [ (validator.field) = { int_gt: 0 } ];
	int64  ended = 3              [ (validator.field) = { int_gt: 0 } ];
	int32  priority = 4           [ (validator.field) = { int_gt: 0, int_lt: 3 } ];
	int32  failure_strategy = 5    [ (validator.field) = { int_gt: 0, int_lt: 3 } ];
	int32  depend_strategy = 6     [ (validator.field) = { int_gt: 0, int_lt: 3 } ];
	int32  schedule_strategy = 7   [ (validator.field) = { int_gt: 0, int_lt: 3 } ];
	int64  schedule_limit = 8     [ (validator.field) = { int_gt: -1 } ];
	string express = 9            [ (validator.field) = { } ];
	int32  notify_strategies = 10 [ (validator.field) = { } ];
	string notify_group = 11      [ (validator.field) = { } ]; // FIXME: Confirm the length of notify group id
}

// Request parameters used to DescribeSchedule
message DescribeScheduleRequest {
	string flow_id = 1 [ (validator.field) = { length_eq: 20 } ];
}

// Reply parameters used to DescribeSchedule
message DescribeScheduleReply {
	model.SchInfo info = 1;
}
